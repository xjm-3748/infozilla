packag ncsu csc itrust action import java sql import java text date format import java text pars import java text simpl date format import java util array list import java util calendar import java util date import java util list import ncsu csc itrust bean messag bean import ncsu csc itrust dao factori import ncsu csc itrust dao mysql messag import ncsu csc itrust dao mysql patient import ncsu csc itrust dao mysql personnel import ncsu csc itrust dao mysql referr import ncsu csc itrust import ncsu csc itrust trust action class view messag jsp public class view messag action privat long log privat patient patient privat personnel personnel privat messag messag privat referr referr set default param factori factori creat action param log user view messag public view messag action factori factori long log log log patient factori patient personnel factori personnel messag factori messag referr factori referr messag log user return list user messag throw public list messag bean messag throw return messag messag log messag log user sort ascend time return list user messag throw public list messag bean messag time ascend throw return messag messag time ascend log messag log user sort ascend order return list user messag throw public list messag bean messag ascend throw return messag messag ascend log messag log user sort descend order return list user messag throw public list messag bean messag descend throw return messag messag descend log messag log user return list user messag throw public list messag bean messag throw return messag messag log messag log user sort ascend time return list user messag throw public list messag bean messag time ascend throw return messag messag time ascend log messag log user sort ascend order return list user messag throw public list messag bean messag ascend throw return messag messag ascend log messag log user sort descend order return list user messag throw public list messag bean messag descend throw return messag messag descend log public string valid creat filter string filter string filter split date format format simpl date format yyyi date null date null tri equal format pars equal format pars null null befor return error date befor start date catch return error date format correct pleas enter date int length replac replac replac string return list messag user base filter criteria param messag list user messag bean param filter string user filter criteria return list messag bean meet criteria filter throw trust throw pars public list messag bean filter messag list messag bean messag string filter throw trust pars list messag bean filter array list messag bean string filter split messag bean messag check sender filter field exclud messag bean doe match request sender specifi equal equal ignor case continu check subject filter field exclud messag bean doe match request subject specifi equal subject equal ignor case continu check bodi messag word exclud messag bean doe word messag bodi equal subject case case bodi case case continu check bodi messag word exclud messag bean doe word messag bodi equal subject case case bodi case case continu check start date filter field exclud messag bean date equal date format format simpl date format yyyi date format pars date continu check date filter field exclud messag bean befor date equal date format format simpl date format yyyi date format pars calendar calendar instanc set time add calendar time befor date continu messag elimin ani filter field add list messag filter add return filter patient param mid patient return patient throw trust public string long mid throw trust mid return patient mid els return personnel mid personnel param mid personnel return personnel throw trust public string personnel long mid throw trust return personnel mid set state messag bean read read user param bean messag bean read public void set read messag bean bean tri messag updat read bean catch auto generat catch block print stack trace number unread messag current user return number unread messag throw public int unread count throw list messag bean messag messag int count messag bean messag read count return count public long link referr long throw return referr referr messag 